<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>आधुनिक अनुवाद प्रणाली</title>
    <!-- Load Tailwind CSS -->
    <!-- NOTE: Tailwind CDN is used as required by the single-file environment, although not recommended for production. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Mukta font (Excellent Devanagari Readability) and Inter (Clean UI) -->
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@400;700;800&family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- Redefined Dark Mode Palette (Deep Space Theme) --- */
        :root {
            --primary-bg: #0d121c; /* Almost Black/Deep Navy */
            --card-bg: #1a2330; /* Dark Panel */
            --accent-color: #00d4ff; /* Vibrant Cyan/Electric Blue */
            --secondary-accent: #8eff00; /* Neon Green for highlights */
            --text-color-light: #e2e8f0; /* Off-White for general text */
            --border-color: #334155;
        }

        body {
            font-family: 'Inter', 'Mukta', Arial, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color-light);
            transition: background-color 0.4s ease;
        }

        /* Set Mukta as primary for Nepali content blocks */
        .nepali-text {
            font-family: 'Mukta', Arial, sans-serif;
        }

        /* --- Animations --- */
        @keyframes slideUpFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-entrance {
            animation: slideUpFadeIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* --- Input and Select Styling --- */
        textarea, select {
            border: 2px solid var(--border-color);
            background-color: #0f172a; /* Deeper background for input fields */
            color: var(--text-color-light);
            transition: all 0.25s ease;
            /* Increased size for better mobile touch targeting */
            min-height: 48px; 
            padding: 12px;
        }

        textarea:focus, 
        select:focus {
            outline: none !important;
            border-color: var(--accent-color) !important;
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.4); /* Cyan Glow */
        }

        /* CRITICAL: Target Language Focus Style (User Request: Black Text) */
        #targetLanguage:focus {
            background-color: #ffffff !important; /* White background for max contrast */
            color: #000000 !important; /* Black text color */
            font-weight: 700;
        }
        
        /* Options in the dropdown when opened should also have high contrast */
        #targetLanguage option {
             background-color: #1a2330;
             color: var(--text-color-light);
        }
        #targetLanguage:focus option {
            background-color: #ffffff; /* White background for the selected/focused option in the list */
            color: #000000;
        }


        /* --- Button Styling --- */
        #translateButton {
            background-image: linear-gradient(90deg, var(--accent-color) 0%, #38bdf8 100%);
            color: var(--primary-bg); 
            font-weight: 800;
            box-shadow: 0 8px 15px -5px rgba(0, 212, 255, 0.6);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        #translateButton:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 25px -5px rgba(0, 212, 255, 0.8);
        }

        #translateButton:active {
            transform: scale(0.98);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* --- Table Styling for Dark Mode --- */
        .table-row-odd {
            background-color: #1f2937; 
        }
        .table-row-even {
            background-color: #111827; 
        }
        
        .table-row-odd:hover, .table-row-even:hover {
            background-color: #2c3a50; /* Subtle hover effect */
        }

        /* Ensure readability on mobile for table text */
        @media (max-width: 640px) {
             .table-row-odd td, .table-row-even td {
                padding: 1rem 0.5rem; /* More vertical padding */
                font-size: 0.875rem; /* Slightly smaller text */
            }
             .table-header-cell {
                font-size: 0.75rem; /* Smaller header text */
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-card-bg shadow-lg sticky top-0 z-10 border-b-4 border-accent-color">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold tracking-wide text-accent-color nepali-text">
                नेपाली <span class="text-white">|</span> विश्वव्यापी अनुवाद प्रणाली
            </h1>
            <p class="mt-1 text-sm sm:text-base text-gray-400">एआई-संचालित, बहुभाषी, वास्तविक-समय अनुवाद इन्टरफेस</p>
        </div>
    </header>

    <!-- Main Content Section -->
    <main class="container mx-auto p-4 sm:p-8 flex-grow">

        <!-- 1. Interactive Translator Section (Advanced Card) -->
        <section class="mb-12 p-6 md:p-10 bg-card-bg rounded-3xl shadow-2xl border border-border-color max-w-5xl mx-auto animate-entrance">
            <h2 class="text-3xl font-extrabold text-center mb-4 text-secondary-accent nepali-text">
                <span class="text-xl mr-2">//</span> लाइभ इन्टरफेस
            </h2>
            <p class="text-sm sm:text-md text-center text-gray-400 mb-8 nepali-text">
                स्रोत भाषा स्वचालित रूपमा पत्ता लाग्नेछ। लक्ष्यित भाषा चयन गर्नुहोस्।
            </p>

            <form id="translateForm" class="space-y-6">
                <!-- Input and Output Area - Responsive Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Text Input -->
                    <div>
                        <label for="textToTranslate" class="font-bold text-gray-300 block mb-2 text-base sm:text-lg nepali-text">स्रोत पाठ (Source Text):</label>
                        <textarea id="textToTranslate" rows="7" placeholder="यहाँ अनुवाद गर्नुपर्ने पाठ टाइप गर्नुहोस्..."
                            class="w-full rounded-xl bg-primary-bg transition duration-200 resize-none placeholder-gray-500 nepali-text text-xl"></textarea>
                    </div>
                    
                    <!-- Translation Result -->
                    <div>
                        <label for="translationResultDisplay" class="font-bold text-gray-300 block mb-2 text-base sm:text-lg nepali-text">अनुवादित आउटपुट (Translated Output):</label>
                        <div id="translationResultDisplay" class="w-full min-h-[196px] p-4 bg-primary-bg border-2 border-border-color rounded-xl text-secondary-accent italic overflow-auto nepali-text text-xl">
                            ...नतिजा यहाँ प्रदर्शित हुनेछ...
                        </div>
                    </div>
                </div>

                <!-- Language Selector and Button -->
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4 pt-4">
                    
                    <div class="w-full sm:w-1/2">
                        <label for="targetLanguage" class="font-bold text-gray-300 block mb-2 nepali-text">लक्ष्यित भाषा छान्नुहोस् (Target Language):</label>
                        <select id="targetLanguage" class="w-full p-3 border border-border-color rounded-xl shadow-sm bg-primary-bg nepali-text transition duration-200 text-lg">
                            <!-- Popular Languages First -->
                            <option value="ne">नेपाली (Nepali)</option>
                            <option value="en" selected>अङ्ग्रेजी (English)</option>
                            <option value="hi">हिन्दी (Hindi)</option>
                            <option value="es">स्पेनी (Spanish)</option>
                            <option value="fr">फ्रान्सेली (French)</option>
                            <option value="de">जर्मन (German)</option>
                            <option value="zh">चिनियाँ (Chinese)</option>
                            <option value="ja">जापानी (Japanese)</option>
                            
                            <!-- Other Supported Languages by Gemini -->
                            <option disabled class="text-gray-500">--- अन्य भाषाहरू ---</option>
                            <option value="ar">अरबी (Arabic)</option>
                            <option value="bn">बङ्गाली (Bengali)</option>
                            <option value="ru">रूसी (Russian)</option>
                            <option value="pt">पोर्तुगाली (Portuguese)</option>
                            <option value="id">इन्डोनेसियाली (Indonesian)</option>
                            <option value="it">इटालियन (Italian)</option>
                            <option value="ko">कोरियाली (Korean)</option>
                            <option value="th">थाई (Thai)</option>
                            <option value="tr">टर्की (Turkish)</option>
                            <option value="vi">भियतनामी (Vietnamese)</option>
                            <option value="nl">डच (Dutch)</option>
                            <option value="pl">पोलिश (Polish)</option>
                            <option value="ro">रोमानियाली (Romanian)</option>
                            <option value="uk">युक्रेनी (Ukrainian)</option>
                            <option value="sv">स्वेडिश (Swedish)</option>
                        </select>
                    </div>

                    <div class="w-full sm:w-1/2 pt-6 sm:pt-0 flex items-end">
                        <button type="button" id="translateButton" class="w-full h-[52px] font-bold rounded-xl flex items-center justify-center">
                            <span id="buttonText" class="transition-opacity duration-200 nepali-text text-lg">अनुवाद सुरु गर्नुहोस्</span>
                            <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-card-bg hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Error/Message Box -->
                <div id="messageBox" class="text-sm p-4 border rounded-xl hidden bg-red-900 border-red-700 text-red-300 nepali-text" role="alert"></div>

            </form>
        </section>

        <!-- Separator -->
        <div class="max-w-5xl mx-auto my-12 border-t border-border-color opacity-50"></div>

        <!-- 2. Static Translation Table (Practice Table) -->
        <section class="p-4 sm:p-6 bg-card-bg rounded-xl shadow-lg max-w-5xl mx-auto border border-border-color animate-entrance delay-200">
            <h2 class="text-xl sm:text-2xl font-extrabold text-center mb-6 text-accent-color border-b-2 border-accent-color pb-2 nepali-text">
                नेपालीबाट अङ्ग्रेजीमा अनुवाद (अभ्यास तालिका)
            </h2>
            <div class="overflow-x-auto rounded-lg border border-border-color">
                <table class="min-w-full divide-y divide-border-color nepali-text">
                    <thead class="bg-primary-bg">
                        <tr>
                            <th class="table-header-cell px-6 py-3 text-center text-xs font-bold text-gray-300 uppercase tracking-wider w-1/2">नेपाली (Nepali)</th>
                            <th class="table-header-cell px-6 py-3 text-center text-xs font-bold text-gray-300 uppercase tracking-wider w-1/2">अङ्ग्रेजी (English)</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-border-color text-sm text-gray-300">
                        <!-- Corrected and verified Nepali Grammar in Table Content -->
                        <tr class="table-row-odd"><td>के हर्कराज मुटुका डाक्टर हुन्?</td><td>Is Harka Raj a heart doctor?</td></tr>
                        <tr class="table-row-even"><td>के संगीता घरमा छिन्?</td><td>Is Sangita at home?</td></tr>
                        <tr class="table-row-odd"><td>के यो तिम्रो ल्यापटप हो?</td><td>Is it your laptop?</td></tr>
                        <tr class="table-row-even"><td>के त्यो बाँदर चलाख छ?</td><td>Is that monkey clever?</td></tr>
                        <tr class="table-row-odd"><td>के त्यो गणेश मन्दिर हो?</td><td>Is this a Ganesh Mandir?</td></tr>
                        <tr class="table-row-even"><td>के यो ठाउँलाई पाल्पा भनिन्छ?</td><td>Is this place called Palpa?</td></tr>
                        <tr class="table-row-odd"><td>के यो कलम रामुको हो?</td><td>Is this Ramu's pen?</td></tr>
                        <tr class="table-row-even"><td>के म एक भान्से हुँ?</td><td>Am I a cook?</td></tr>
                        <tr class="table-row-odd"><td>के म एक बसचालक हुँ?</td><td>Am I a bus driver?</td></tr>
                        <tr class="table-row-even"><td>के म एक इन्जिनियर हुँ?</td><td>Am I an engineer?</td></tr>
                        <tr class="table-row-odd"><td>के म एक तरकारी व्यापारी हुँ?</td><td>Am I a green grocer?</td></tr>
                        <tr class="table-row-even"><td>के म एक लेखक हुँ?</td><td>Am I a writer?</td></tr>
                        <tr class="table-row-odd"><td>के म एक चलाख केटो हुँ?</td><td>Am I a clever boy?</td></tr>
                        <tr class="table-row-even"><td>के म एक लजालु केटी हुँ?</td><td>Am I a shy girl?</td></tr>
                        <tr class="table-row-odd"><td>के यी बसहरू तिम्रा हुन्?</td><td>Are these buses yours?</td></tr>
                        <tr class="table-row-even"><td>के तिनीहरू नर्तक हुन्?</td><td>Are they dancers?</td></tr>
                        <tr class="table-row-odd"><td>के तिनीहरू गायक हुन्?</td><td>Are they singers?</td></tr>
                        <tr class="table-row-even"><td>के उहाँहरू तपाईंको बा-आमा हुनुहुन्छ?</td><td>Are they your parents?</td></tr>
                        <tr class="table-row-odd"><td>के यी भान्साका सामानहरू हुन्?</td><td>Are these kitchen tools?</td></tr>
                        <tr class="table-row-even"><td>के हामी खेलाडीहरू हौं?</td><td>Are we the players?</td></tr>
                        <tr class="table-row-odd"><td>के हामी असल विद्यार्थी हौं?</td><td>Are we good students?</td></tr>
                        <tr class="table-row-even"><td>के हामी घनिष्ठ साथी हौं?</td><td>Are we close friends?</td></tr>
                        <tr class="table-row-odd"><td>के तिमी अङ्ग्रेजी सिक्छौ?</td><td>Do you learn English?</td></tr>
                        <tr class="table-row-even"><td>के तिमी नेपाली सिक्छौ?</td><td>Do you learn Nepali?</td></tr>
                        <tr class="table-row-odd"><td>के तिनीहरू फ्रेन्च बोल्छन्?</td><td>Do they speak French?</td></tr>
                        <tr class="table-row-even"><td>के हामी सङ्ग्रहालय घुम्न जान्छौं?</td><td>Do we visit the museum?</td></tr>
                        <tr class="table-row-odd"><td>के हामी ग्रीष्मका लागि फ्यान किन्छौं?</td><td>Do we buy a fan for summer?</td></tr>
                        <tr class="table-row-even"><td>के चराहरू लामो दूरी हिँड्न सक्छन्?</td><td>Do the birds walk a long distance?</td></tr>
                        <tr class="table-row-odd"><td>के नेताहरूले राम्रो काम गर्छन्?</td><td>Do the leaders work well?</td></tr>
                        <tr class="table-row-even"><td>के डाक्टरहरू नर्सहरूलाई पढाउँछन्?</td><td>Do the doctors teach the nurses?</td></tr>
                        <tr class="table-row-odd"><td>के ड्राइभरहरूले राम्ररी गाडी चलाउँछन्?</td><td>Do the drivers drive well?</td></tr>
                        <tr class="table-row-even"><td>के शिक्षकहरू विद्यार्थीहरूलाई पढाउँछन्?</td><td>Do the teachers teach the students?</td></tr>
                        <tr class="table-row-odd"><td>के उनी नृत्य सिक्दैछिन्?</td><td>Is she learning dancing?</td></tr>
                        <tr class="table-row-even"><td>के म प्रेम कथाको किताब लेख्दैछु?</td><td>Am I writing a book of love story?</td></tr>
                        <tr class="table-row-odd"><td>के म एउटा विद्यालयमा केटाकेटीहरू पढाउँदैछु?</td><td>Am I teaching the kids at a school?</td></tr>
                        <tr class="table-row-even"><td>के कोही पनि झूठ बोलिरहेका छैनन्?</td><td>Is anybody telling lies?</td></tr>
                        <tr class="table-row-odd"><td>म जापानी भाषा सिक्दै थिइनँ।</td><td>I was not learning Japanese.</td></tr>
                        <tr class="table-row-even"><td>उनी नृत्य सिक्दै थिइनन्।</td><td>She was not learning dancing.</td></tr>
                        <tr class="table-row-odd"><td>मलाई त्यहाँ कसैले बोलाइरहेको थिएन।</td><td>Nobody was calling me there.</td></tr>
                        <tr class="table-row-even"><td>कोही पनि लेखिरहेका थिएनन्।</td><td>None was writing.</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <!-- Footer Section -->
    <footer class="bg-primary-bg text-gray-500 p-4 text-center mt-auto shadow-inner border-t border-border-color">
        <p class="text-xs sm:text-sm nepali-text">&copy; 2024 Advanced Translation System. AI Powered. सर्वाधिकार सुरक्षित।</p>
    </footer>

    <!-- JavaScript for Interactive Translation using Gemini API -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translateButton = document.getElementById('translateButton');
            const textToTranslate = document.getElementById('textToTranslate');
            const targetLanguageSelect = document.getElementById('targetLanguage');
            const translationResult = document.getElementById('translationResultDisplay');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const buttonTextSpan = document.getElementById('buttonText');
            const messageBox = document.getElementById('messageBox');

            // API Key provided by the user for translation service.
            const apiKey = "AIzaSyAsMYxIz5tfVJ1qXG71RnpoxP67OfpXIUc"; 
            const model = 'gemini-2.5-flash-preview-05-20';
            const apiUrlBase = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent`;

            // Function to display messages (instead of using alert())
            const displayMessage = (message, isError = false) => {
                messageBox.textContent = message;
                messageBox.classList.remove('hidden', 'bg-red-900', 'border-red-700', 'text-red-300', 'bg-green-900', 'border-green-700', 'text-green-300');
                
                if (isError) {
                    messageBox.classList.add('bg-red-900', 'border-red-700', 'text-red-300');
                } else {
                    // Use a subtle green for success in dark mode
                    messageBox.classList.add('bg-green-900', 'border-green-700', 'text-green-300');
                }
                // Scroll to the message box for visibility
                messageBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
            };

            const clearMessage = () => {
                messageBox.classList.add('hidden');
                messageBox.textContent = '';
            };

            // Utility function for exponential backoff retry logic
            const exponentialBackoffFetch = async (url, options, maxRetries = 5) => {
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) {
                            return response;
                        }
                        // Retry on throttling/server errors
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`Server error: ${response.status}`);
                        }
                        // For other client errors (4xx), don't retry, just throw
                        const errorData = await response.json();
                        throw new Error(errorData.error ? errorData.error.message : `HTTP error! Status: ${response.status}`);
                    } catch (error) {
                        if (i === maxRetries - 1) {
                            throw error; // Last retry failed, propagate error
                        }
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            };

            const translateText = async () => {
                const text = textToTranslate.value.trim();
                if (!text) {
                    displayMessage('त्रुटि: कृपया अनुवाद गर्नुपर्ने पाठ प्रविष्ट गर्नुहोस्।', true);
                    translationResult.textContent = '...नतिजा यहाँ प्रदर्शित हुनेछ...';
                    return;
                }
                clearMessage();

                const targetLanguageCode = targetLanguageSelect.value;
                const targetLanguageName = targetLanguageSelect.options[targetLanguageSelect.selectedIndex].text.split('(')[0].trim(); 

                // Construct API URL using the provided API Key.
                const apiUrl = `${apiUrlBase}?key=${apiKey}`;


                // Enhanced System Prompt for an "Advanced Translator" Persona
                const systemPrompt = `You are a high-fidelity, real-time, multilingual translation engine. Automatically detect the source language of the input and translate it with 100% accuracy into the target language: ${targetLanguageName} (Code: ${targetLanguageCode}). Deliver ONLY the precise translated text. DO NOT add any prefixes, suffixes, explanations, or markdown formatting whatsoever.`;
                const userQuery = `Input text for translation: "${text}"`;


                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                // UI Loading State
                translateButton.disabled = true;
                loadingSpinner.classList.remove('hidden');
                buttonTextSpan.textContent = 'प्रक्रियामा...';
                translationResult.textContent = 'डाटा ट्रान्समिट हुँदैछ...';
                translationResult.classList.add('animate-pulse'); 

                try {
                    const response = await exponentialBackoffFetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    
                    const candidate = result.candidates?.[0];
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const translatedText = candidate.content.parts[0].text.trim();
                        
                        // Apply animation to the result by slightly delaying the content update
                        setTimeout(() => {
                             translationResult.textContent = translatedText;
                        }, 50);

                        displayMessage('सफलता: अनुवाद पूरा भयो।', false);

                    } else {
                        translationResult.textContent = 'अनुवाद त्रुटि: प्रतिक्रियामा सामग्री पाइएन।';
                        displayMessage('गम्भीर त्रुटि: API प्रतिक्रिया अपूर्ण छ।', true);
                        console.error('API response structure missing content:', result);
                    }

                } catch (error) {
                    let errorMessage;
                    const errorString = error.toString();

                    // Specific check for the 403 or authentication errors
                    if (errorString.includes('403') || errorString.includes('unregistered callers') || errorString.includes('authentication')) {
                        errorMessage = 'प्रमाणीकरण त्रुटि (403): API कुञ्जीमा समस्या छ वा यसलाई पहुँच अनुमति छैन।';
                    } else if (errorString.includes('Server error')) {
                        errorMessage = `सर्भर त्रुटि: API कल असफल भयो। (${error.message})`;
                    } else {
                        errorMessage = 'नेटवर्क त्रुटि: कृपया आफ्नो इन्टरनेट जडान जाँच गर्नुहोस्।';
                    }

                    translationResult.textContent = 'अनुवाद असफल भयो।';
                    displayMessage(errorMessage, true);
                    console.error("Translation failed:", error);
                } finally {
                    // Reset UI State
                    translateButton.disabled = false;
                    loadingSpinner.classList.add('hidden');
                    buttonTextSpan.textContent = 'अनुवाद सुरु गर्नुहोस्';
                    translationResult.classList.remove('animate-pulse');
                }
            };

            translateButton.addEventListener('click', translateText);
        });
    </script>
</body>

</html>
